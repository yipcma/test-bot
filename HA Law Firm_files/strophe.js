if(!Function.prototype.bind)Function.prototype.bind=function(obj){var func=this;return function(){return func.apply(obj,arguments)}};if(!Function.prototype.prependArg)Function.prototype.prependArg=function(arg){var func=this;return function(){var newargs=[arg];for(var i=0;i<arguments.length;i++)newargs.push(arguments[i]);return func.apply(this,newargs)}};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(elt){var len=this.length;var from=Number(arguments[1])||0;from=from<0?Math.ceil(from):Math.floor(from);if(from<0)from+=len;for(;from<len;from++)if(from in this&&this[from]===elt)return from;return-1};(function(callback){var Strophe;function $build(name,attrs){return new Strophe.Builder(name,attrs)}function $msg(attrs){return new Strophe.Builder("message",attrs)}function $iq(attrs){return new Strophe.Builder("iq",attrs)}function $pres(attrs){return new Strophe.Builder("presence",attrs)}Strophe={VERSION:"1.0.1",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"},addNamespace:function(name,value){Strophe.NS[name]=value},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,forEachChild:function(elem,elemName,func){var i,childNode;for(i=0;i<elem.childNodes.length;i++){childNode=elem.childNodes[i];if(childNode.nodeType==Strophe.ElementType.NORMAL&&(!elemName||this.isTagEqual(childNode,elemName)))func(childNode)}},isTagEqual:function(el,name){return el.tagName.toLowerCase()==name.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var doc;if(window.ActiveXObject){doc=new ActiveXObject("Microsoft.XMLDOM");doc.appendChild(doc.createElement("strophe"))}else doc=document.implementation.createDocument("jabber:client","strophe",null);return doc},xmlElement:function(name){if(!name)return null;var node=null;if(!Strophe._xmlGenerator)Strophe._xmlGenerator=Strophe._makeGenerator();node=Strophe._xmlGenerator.createElement(name);var a,i,k;for(a=1;a<arguments.length;a++){if(!arguments[a])continue;if(typeof arguments[a]=="string"||typeof arguments[a]=="number")node.appendChild(Strophe.xmlTextNode(arguments[a]));else if(typeof arguments[a]=="object"&&typeof arguments[a].sort=="function")for(i=0;i<arguments[a].length;i++){if(typeof arguments[a][i]=="object"&&typeof arguments[a][i].sort=="function")node.setAttribute(arguments[a][i][0],arguments[a][i][1])}else if(typeof arguments[a]=="object")for(k in arguments[a])if(arguments[a].hasOwnProperty(k)&&arguments[a][k]!=null)node.setAttribute(k,arguments[a][k])}return node},xmlescape:function(text){text=text.replace(/\&/g,"&amp;");text=text.replace(/</g,"&lt;");text=text.replace(/>/g,"&gt;");return text},xmlTextNode:function(text){text=Strophe.xmlescape(text);if(!Strophe._xmlGenerator)Strophe._xmlGenerator=Strophe._makeGenerator();return Strophe._xmlGenerator.createTextNode(text)},getText:function(elem){if(!elem)return null;var str="";if(elem.childNodes.length===0&&elem.nodeType==Strophe.ElementType.TEXT)str+=elem.nodeValue;for(var i=0;i<elem.childNodes.length;i++)if(elem.childNodes[i].nodeType==Strophe.ElementType.TEXT)str+=elem.childNodes[i].nodeValue;return str},copyElement:function(elem){var i,el;if(elem.nodeType==Strophe.ElementType.NORMAL){el=Strophe.xmlElement(elem.tagName);for(i=0;i<elem.attributes.length;i++)el.setAttribute(elem.attributes[i].nodeName.toLowerCase(),elem.attributes[i].value);for(i=0;i<elem.childNodes.length;i++)el.appendChild(Strophe.copyElement(elem.childNodes[i]))}else if(elem.nodeType==Strophe.ElementType.TEXT)el=Strophe.xmlTextNode(elem.nodeValue);return el},escapeNode:function(node){return node.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(node){return node.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(jid){if(jid.indexOf("@")<0)return null;return jid.split("@")[0]},getDomainFromJid:function(jid){var bare=Strophe.getBareJidFromJid(jid);if(bare.indexOf("@")<0)return bare;else{var parts=bare.split("@");parts.splice(0,1);return parts.join("@")}},getResourceFromJid:function(jid){if(jid.indexOf("/")>0){var s=jid.split("/");if(s.length<2)return null;s.splice(0,1);return s.join("/")}},getBareJidFromJid:function(jid){return jid.split("/")[0]},log:function(level,msg){return},debug:function(msg){this.log(this.LogLevel.DEBUG,msg)},info:function(msg){this.log(this.LogLevel.INFO,msg)},warn:function(msg){this.log(this.LogLevel.WARN,msg)},error:function(msg){this.log(this.LogLevel.ERROR,msg)},fatal:function(msg){this.log(this.LogLevel.FATAL,msg)},serialize:function(elem){var result;if(!elem)return null;if(typeof elem.tree==="function")elem=elem.tree();var nodeName=elem.nodeName;var i,child;if(elem.getAttribute("_realname"))nodeName=elem.getAttribute("_realname");result="<"+nodeName;for(i=0;i<elem.attributes.length;i++)if(elem.attributes[i].nodeName!="_realname")result+=" "+elem.attributes[i].nodeName.toLowerCase()+"='"+elem.attributes[i].value.replace("&","&amp;").replace("'","&apos;").replace("<","&lt;")+"'";if(elem.childNodes.length>0){result+=">";for(i=0;i<elem.childNodes.length;i++){child=elem.childNodes[i];if(child.nodeType==Strophe.ElementType.NORMAL)result+=Strophe.serialize(child);else if(child.nodeType==Strophe.ElementType.TEXT)result+=child.nodeValue}result+="</"+nodeName+">"}else result+="/>";return result},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(name,ptype){Strophe._connectionPlugins[name]=ptype}};Strophe.Builder=function(name,attrs){if(name=="presence"||name=="message"||name=="iq")if(attrs&&!attrs.xmlns)attrs.xmlns=Strophe.NS.CLIENT;else if(!attrs)attrs={xmlns:Strophe.NS.CLIENT};this.nodeTree=Strophe.xmlElement(name,attrs);this.node=this.nodeTree};Strophe.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return Strophe.serialize(this.nodeTree)},up:function(){this.node=this.node.parentNode;return this},attrs:function(moreattrs){for(var k in moreattrs)if(moreattrs.hasOwnProperty(k))this.node.setAttribute(k,moreattrs[k]);return this},c:function(name,attrs){var child=Strophe.xmlElement(name,attrs);this.node.appendChild(child);this.node=child;return this},cnode:function(elem){this.node.appendChild(elem);this.node=elem;return this},t:function(text){var child=Strophe.xmlTextNode(text);this.node.appendChild(child);return this}};Strophe.Handler=function(handler,ns,name,type,id,from,options){this.handler=handler;this.ns=ns;this.name=name;this.type=type;this.id=id;this.options=options||{matchbare:false};if(!this.options.matchBare)this.options.matchBare=false;if(this.options.matchBare)this.from=Strophe.getBareJidFromJid(from);else this.from=from;this.user=true};Strophe.Handler.prototype={isMatch:function(elem){var nsMatch;var from=null;if(this.options.matchBare)from=Strophe.getBareJidFromJid(elem.getAttribute("from"));else from=elem.getAttribute("from");nsMatch=false;if(!this.ns)nsMatch=true;else{var that=this;Strophe.forEachChild(elem,null,function(elem){if(elem.getAttribute("xmlns")==that.ns)nsMatch=true});nsMatch=nsMatch||elem.getAttribute("xmlns")==this.ns}if(nsMatch&&(!this.name||Strophe.isTagEqual(elem,this.name))&&(!this.type||elem.getAttribute("type")===this.type)&&(!this.id||elem.getAttribute("id")===this.id)&&(!this.from||from===this.from))return true;return false},run:function(elem){var result=null;try{result=this.handler(elem)}catch(e){if(e.sourceURL)Strophe.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message);else if(e.fileName){if(typeof console!="undefined"){console.trace();console.error(this.handler," - error - ",e,e.message)}Strophe.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message)}else Strophe.fatal("error: "+this.handler);throw e;}return result},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};Strophe.TimedHandler=function(period,handler){this.period=period;this.handler=handler;this.lastCalled=(new Date).getTime();this.user=true};Strophe.TimedHandler.prototype={run:function(){this.lastCalled=(new Date).getTime();return this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}};Strophe.Request=function(elem,func,rid,sends){this.id=++Strophe._requestId;this.xmlData=elem;this.data=Strophe.serialize(elem);this.origFunc=func;this.func=func;this.rid=rid;this.date=NaN;this.sends=sends||0;this.abort=false;this.dead=null;this.age=function(){if(!this.date)return 0;var now=new Date;return(now-this.date)/1E3};this.timeDead=function(){if(!this.dead)return 0;var now=new Date;return(now-this.dead)/1E3};this.xhr=this._newXHR()};Strophe.Request.prototype={getResponse:function(){var node=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){node=this.xhr.responseXML.documentElement;if(node.tagName=="parsererror"){Strophe.error("invalid response received");Strophe.error("responseText: "+
this.xhr.responseText);Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML));throw"parsererror";}}else if(this.xhr.responseText){Strophe.error("invalid response received");Strophe.error("responseText: "+this.xhr.responseText);Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML))}return node},_newXHR:function(){var xhr=false;if(window.XMLHttpRequest){xhr=new XMLHttpRequest;if(xhr.overrideMimeType)xhr.overrideMimeType("text/xml")}else if(window.ActiveXObject)xhr=new ActiveXObject("Microsoft.XMLHTTP");xhr.onreadystatechange=this.func.prependArg(this);return xhr}};Strophe.Connection=function(service){this.service=service;this.jid="";this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.streamId=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._idleTimeout=null;this._disconnectTimeout=null;this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this.paused=false;this.hold=1;this.wait=60;this.window=5;this._data=[];this._requests=[];this._uniqueId=Math.round(Math.random()*1E4);this._sasl_success_handler=null;this._sasl_failure_handler=null;this._sasl_challenge_handler=null;this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var k in Strophe._connectionPlugins)if(Strophe._connectionPlugins.hasOwnProperty(k)){var ptype=Strophe._connectionPlugins[k];var F=function(){};F.prototype=ptype;this[k]=new F;this[k].init(this)}};Strophe.Connection.prototype={reset:function(){this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.streamId=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this._requests=[];this._uniqueId=Math.round(Math.random()*1E4)},pause:function(){this.paused=true},getJID:function(){return this.jid},getSID:function(){return this.sid},resume:function(){this.paused=false},getUniqueId:function(suffix){if(typeof suffix=="string"||typeof suffix=="number")return++this._uniqueId+":"+suffix;else return++this._uniqueId+""},connect:function(jid,pass,callback,wait,hold){this.jid=jid;this.pass=pass;this.connect_callback=callback;this.disconnecting=false;this.connected=false;this.authenticated=false;this.errors=0;this.wait=wait||this.wait;this.hold=hold||this.hold;this.domain=Strophe.getDomainFromJid(this.jid);var body=this._buildBody().attrs({to:this.domain,"xml:lang":"en",wait:this.wait,route:WGWindowConstant.XMPP_ROUTE,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Strophe.NS.BOSH});this._changeConnectStatus(Strophe.Status.CONNECTING,null);this._requests.push(new Strophe.Request(body.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),body.tree().getAttribute("rid")));this._throttledRequestHandler()},attach:function(jid,sid,rid,callback,wait,hold,wind){this.jid=jid;this.sid=sid;this.rid=rid;this.connect_callback=callback;this.domain=Strophe.getDomainFromJid(this.jid);this.authenticated=true;this.connected=true;this.wait=wait||this.wait;this.hold=hold||this.hold;this.window=wind||this.window;this._changeConnectStatus(Strophe.Status.ATTACHED,null)},xmlInput:function(elem){return},xmlOutput:function(elem){return},rawInput:function(data){return},rawOutput:function(data){return},send:function(elem){if(elem===null)return;if(typeof elem.sort==="function")for(var i=0;i<elem.length;i++)this._queueData(elem[i]);else if(typeof elem.tree==="function")this._queueData(elem.tree());else this._queueData(elem);this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},flush:function(){clearTimeout(this._idleTimeout);this._onIdle()},sendIQ:function(elem,callback,errback,timeout){var timeoutHandler=null;var that=this;if(typeof elem.tree==="function")elem=elem.tree();var id=elem.getAttribute("id");if(!id){id=this.getUniqueId("sendIQ");elem.setAttribute("id",id)}var handler=this.addHandler(function(stanza){if(timeoutHandler)that.deleteTimedHandler(timeoutHandler);var iqtype=stanza.getAttribute("type");if(iqtype==="result"){if(callback)callback(stanza)}else if(iqtype==="error"){if(errback)errback(stanza)}else throw{name:"StropheError",message:"Got bad IQ type of "+iqtype};},null,"iq",null,id);if(timeout)timeoutHandler=this.addTimedHandler(timeout,function(){that.deleteHandler(handler);if(errback)errback(null);return false});this.send(elem);return id},_queueData:function(element){if(element===null||!element.tagName||!element.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(element)},_sendRestart:function(){this._data.push("restart");this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(period,handler){var thand=new Strophe.TimedHandler(period,handler);this.addTimeds.push(thand);return thand},deleteTimedHandler:function(handRef){this.removeTimeds.push(handRef)},addHandler:function(handler,ns,name,type,id,from,options){var hand=new Strophe.Handler(handler,ns,name,type,id,from,options);this.addHandlers.push(hand);return hand},deleteHandler:function(handRef){this.removeHandlers.push(handRef)},disconnect:function(reason){this._changeConnectStatus(Strophe.Status.DISCONNECTING,reason);Strophe.info("Disconnect was called because: "+reason);if(this.connected){this._disconnectTimeout=this._addSysTimedHandler(3E3,this._onDisconnectTimeout.bind(this));this._sendTerminate()}},_changeConnectStatus:function(status,condition){for(var k in Strophe._connectionPlugins)if(Strophe._connectionPlugins.hasOwnProperty(k)){var plugin=this[k];if(plugin.statusChanged)try{plugin.statusChanged(status,condition)}catch(err){Strophe.error(""+k+" plugin caused an exception "+"changing status: "+err)}}if(this.connect_callback)try{this.connect_callback(status,condition)}catch(e){Strophe.error("User connection callback caused an "+"exception: "+e)}},_buildBody:function(){var bodyWrap=$build("body",{rid:this.rid++,xmlns:Strophe.NS.HTTPBIND});if(this.sid!==null)bodyWrap.attrs({sid:this.sid});return bodyWrap},_removeRequest:function(req){Strophe.debug("removing request");var i;for(i=this._requests.length-1;i>=0;i--)if(req==this._requests[i])this._requests.splice(i,1);req.xhr.onreadystatechange=function(){};this._throttledRequestHandler()},_restartRequest:function(i){var req=this._requests[i];if(req.dead===null)req.dead=new Date;this._processRequest(i)},_processRequest:function(i){var req=this._requests[i];var reqStatus=-1;try{if(req.xhr.readyState==4)reqStatus=req.xhr.status}catch(e){Strophe.error("caught an error in _requests["+i+"], reqStatus: "+reqStatus)}if(typeof reqStatus=="undefined")reqStatus=-1;var time_elapsed=req.age();var primaryTimeout=!isNaN(time_elapsed)&&time_elapsed>Math.floor(Strophe.TIMEOUT*this.wait);var secondaryTimeout=req.dead!==null&&req.timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait);var requestCompletedWithServerError=req.xhr.readyState==4&&(reqStatus<1||reqStatus>=500);if(primaryTimeout||secondaryTimeout||requestCompletedWithServerError){if(secondaryTimeout)Strophe.error("Request "+this._requests[i].id+" timed out (secondary), restarting");req.abort=true;req.xhr.abort();req.xhr.onreadystatechange=function(){};this._requests[i]=new Strophe.Request(req.xmlData,req.origFunc,req.rid,req.sends);req=this._requests[i]}if(req.xhr.readyState===0){Strophe.debug("request id "+req.id+"."+req.sends+" posting");req.date=new Date;try{req.xhr.open("POST",this.service,true)}catch(e2){Strophe.error("XHR open failed.");if(!this.connected)this._changeConnectStatus(Strophe.Status.CONNFAIL,"bad-service");this.disconnect();return}var sendFunc=function(){req.xhr.send(req.data)};if(req.sends>1){var backoff=Math.pow(req.sends,3)*1E3;setTimeout(sendFunc,backoff)}else sendFunc();req.sends++;this.xmlOutput(req.xmlData);this.rawOutput(req.data)}else Strophe.debug("_processRequest: "+(i===0?"first":"second")+" request has readyState of "+req.xhr.readyState)},_throttledRequestHandler:function(){if(!this._requests)Strophe.debug("_throttledRequestHandler called with "+"undefined requests");else Strophe.debug("_throttledRequestHandler called with "+this._requests.length+" requests");if(!this._requests||this._requests.length===0)return;if(this._requests.length>0)this._processRequest(0);if(this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window-1)this._processRequest(1)},_onRequestStateChange:function(func,req){Strophe.debug("request id "+req.id+"."+req.sends+" state changed to "+req.xhr.readyState);if(req.abort){req.abort=false;return}var reqStatus;if(req.xhr.readyState==4){reqStatus=0;try{reqStatus=req.xhr.status}catch(e){}if(typeof reqStatus=="undefined")reqStatus=0;if(this.disconnecting)if(reqStatus>=400){this._hitError(reqStatus);return}var reqIs0=this._requests[0]==req;var reqIs1=this._requests[1]==req;if(reqStatus>0&&reqStatus<500||req.sends>5){this._removeRequest(req);Strophe.debug("request id "+req.id+" should now be removed")}if(reqStatus==200){if(reqIs1||reqIs0&&this._requests.length>0&&this._requests[0].age()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait))this._restartRequest(0);Strophe.debug("request id "+req.id+"."+req.sends+" got 200");func(req);this.errors=0}else{Strophe.error("request id "+req.id+"."+req.sends+" error "+reqStatus+" happened");if(reqStatus===0||reqStatus>=400&&reqStatus<600||reqStatus>=12E3){this._hitError(reqStatus);if(reqStatus>=400&&reqStatus<500){this._changeConnectStatus(Strophe.Status.DISCONNECTING,null);this._doDisconnect()}}}if(!(reqStatus>0&&reqStatus<1E4||req.sends>5))this._throttledRequestHandler()}},_hitError:function(reqStatus){this.errors++;Strophe.warn("request errored, status: "+reqStatus+", number of errors: "+this.errors);if(this.errors>4)this._onDisconnectTimeout()},_doDisconnect:function(){Strophe.info("_doDisconnect was called");this.authenticated=false;this.disconnecting=false;this.sid=null;this.streamId=null;this.rid=Math.floor(Math.random()*4294967295);if(this.connected){this._changeConnectStatus(Strophe.Status.DISCONNECTED,null);this.connected=false}this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[]},_dataRecv:function(req){try{var elem=req.getResponse()}catch(e){if(e!="parsererror")throw e;this.disconnect("strophe-parsererror")}if(elem===null)return;this.xmlInput(elem);this.rawInput(Strophe.serialize(elem));var i,hand;while(this.removeHandlers.length>0){hand=this.removeHandlers.pop();i=this.handlers.indexOf(hand);if(i>=0)this.handlers.splice(i,1)}while(this.addHandlers.length>0)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._requests.length===0){this.deleteTimedHandler(this._disconnectTimeout);this._disconnectTimeout=null;this._doDisconnect();return}var typ=elem.getAttribute("type");var cond,conflict;if(typ!==null&&typ=="terminate"){cond=elem.getAttribute("condition");conflict=elem.getElementsByTagName("conflict");if(cond!==null){if(cond=="remote-stream-error"&&conflict.length>0)cond="conflict";this._changeConnectStatus(Strophe.Status.CONNFAIL,cond)}else this._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown");this.disconnect();return}var that=this;Strophe.forEachChild(elem,null,function(child){var i,newList;newList=that.handlers;that.handlers=[];for(i=0;i<newList.length;i++){var hand=newList[i];if(hand.isMatch(child)&&(that.authenticated||!hand.user)){if(hand.run(child))that.handlers.push(hand)}else that.handlers.push(hand)}})},_sendTerminate:function(){Strophe.info("_sendTerminate was called");var body=this._buildBody().attrs({type:"terminate"});if(this.authenticated)body.c("presence",{xmlns:Strophe.NS.CLIENT,type:"unavailable"});this.disconnecting=true;var req=new Strophe.Request(body.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),body.tree().getAttribute("rid"));this._requests.push(req);this._throttledRequestHandler()},_connect_cb:function(req){Strophe.info("_connect_cb was called");this.connected=true;var bodyWrap=req.getResponse();if(!bodyWrap)return;this.xmlInput(bodyWrap);this.rawInput(Strophe.serialize(bodyWrap));var typ=bodyWrap.getAttribute("type");var cond,conflict;if(typ!==null&&typ=="terminate"){cond=bodyWrap.getAttribute("condition");conflict=bodyWrap.getElementsByTagName("conflict");if(cond!==null){if(cond=="remote-stream-error"&&conflict.length>0)cond="conflict";this._changeConnectStatus(Strophe.Status.CONNFAIL,cond)}else this._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown");return}if(!this.sid)this.sid=bodyWrap.getAttribute("sid");if(!this.stream_id)this.stream_id=bodyWrap.getAttribute("authid");var wind=bodyWrap.getAttribute("requests");if(wind)this.window=parseInt(wind,10);var hold=bodyWrap.getAttribute("hold");if(hold)this.hold=parseInt(hold,10);var wait=bodyWrap.getAttribute("wait");if(wait)this.wait=parseInt(wait,10);var do_sasl_plain=false;var do_sasl_digest_md5=false;var do_sasl_anonymous=false;var mechanisms=bodyWrap.getElementsByTagName("mechanism");var i,mech,auth_str,hashed_auth_str;if(mechanisms.length>0)for(i=0;i<mechanisms.length;i++){mech=Strophe.getText(mechanisms[i]);if(mech=="DIGEST-MD5")do_sasl_digest_md5=true;else if(mech=="PLAIN")do_sasl_plain=true;else if(mech=="ANONYMOUS")do_sasl_anonymous=true}else{var body=this._buildBody();this._requests.push(new Strophe.Request(body.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),body.tree().getAttribute("rid")));this._throttledRequestHandler();return}if(Strophe.getNodeFromJid(this.jid)===null&&do_sasl_anonymous){this._changeConnectStatus(Strophe.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("auth",{xmlns:Strophe.NS.SASL,mechanism:"ANONYMOUS"}).tree())}else if(Strophe.getNodeFromJid(this.jid)===null){this._changeConnectStatus(Strophe.Status.CONNFAIL,"x-strophe-bad-non-anon-jid");this.disconnect()}else if(do_sasl_digest_md5){this._changeConnectStatus(Strophe.Status.AUTHENTICATING,null);this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("auth",{xmlns:Strophe.NS.SASL,mechanism:"DIGEST-MD5"}).tree())}else if(do_sasl_plain){auth_str=Strophe.getBareJidFromJid(this.jid);auth_str=auth_str+"\x00";auth_str=auth_str+Strophe.getNodeFromJid(this.jid);auth_str=auth_str+"\x00";auth_str=auth_str+this.pass;this._changeConnectStatus(Strophe.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);hashed_auth_str=Base64.encode(auth_str);this.send($build("auth",{xmlns:Strophe.NS.SASL,mechanism:"PLAIN"}).t(hashed_auth_str).tree())}else{this._changeConnectStatus(Strophe.Status.AUTHENTICATING,null);this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1");this.send($iq({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:Strophe.NS.AUTH}).c("username",{}).t(Strophe.getNodeFromJid(this.jid)).tree())}},_sasl_challenge1_cb:function(elem){var attribMatch=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/;var challenge=Base64.decode(Strophe.getText(elem));var cnonce=MD5.hexdigest(Math.random()*1234567890);var realm="";var host=null;var nonce="";var qop="";var matches;this.deleteHandler(this._sasl_failure_handler);while(challenge.match(attribMatch)){matches=challenge.match(attribMatch);challenge=challenge.replace(matches[0],"");matches[2]=matches[2].replace(/^"(.+)"$/,"$1");switch(matches[1]){case"realm":realm=matches[2];break;case"nonce":nonce=matches[2];break;case"qop":qop=matches[2];break;case"host":host=matches[2];break}}var digest_uri="xmpp/"+this.domain;if(host!==null)digest_uri=digest_uri+"/"+host;var A1=MD5.hash(Strophe.getNodeFromJid(this.jid)+":"+realm+":"+this.pass)+":"+nonce+":"+cnonce;var A2="AUTHENTICATE:"+digest_uri;var responseText="";responseText+="username="+this._quote(Strophe.getNodeFromJid(this.jid))+",";responseText+="realm="+this._quote(realm)+",";responseText+="nonce="+this._quote(nonce)+",";responseText+="cnonce="+this._quote(cnonce)+",";responseText+='nc="00000001",';responseText+='qop="auth",';responseText+="digest-uri="+this._quote(digest_uri)+",";responseText+="response="+this._quote(MD5.hexdigest(MD5.hexdigest(A1)+":"+nonce+":00000001:"+cnonce+":auth:"+MD5.hexdigest(A2)))+",";responseText+='charset="utf-8"';this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",null,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("response",{xmlns:Strophe.NS.SASL}).t(Base64.encode(responseText)).tree());return false},_quote:function(str){return'"'+str.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},_sasl_challenge2_cb:function(elem){this.deleteHandler(this._sasl_success_handler);this.deleteHandler(this._sasl_failure_handler);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("response",{xmlns:Strophe.NS.SASL}).tree());return false},_auth1_cb:function(elem){var iq=$iq({type:"set",id:"_auth_2"}).c("query",{xmlns:Strophe.NS.AUTH}).c("username",{}).t(Strophe.getNodeFromJid(this.jid)).up().c("password").t(this.pass);if(!Strophe.getResourceFromJid(this.jid))this.jid=Strophe.getBareJidFromJid(this.jid)+"/strophe";iq.up().c("resource",{}).t(Strophe.getResourceFromJid(this.jid));this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2");this.send(iq.tree());return false},_sasl_success_cb:function(elem){Strophe.info("SASL authentication succeeded.");this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null);this._sendRestart();return false},_sasl_auth1_cb:function(elem){var i,child;for(i=0;i<elem.childNodes.length;i++){child=elem.childNodes[i];if(child.nodeName=="bind")this.do_bind=true;if(child.nodeName=="session")this.do_session=true}if(!this.do_bind){this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false}else{this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var resource=Strophe.getResourceFromJid(this.jid);if(resource)this.send($iq({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Strophe.NS.BIND}).c("resource",{}).t(resource).tree());else this.send($iq({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Strophe.NS.BIND}).tree())}return false},_sasl_bind_cb:function(elem){if(elem.getAttribute("type")=="error"){Strophe.info("SASL binding failed.");this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false}var bind=elem.getElementsByTagName("bind");var jidNode;if(bind.length>0){jidNode=bind[0].getElementsByTagName("jid");if(jidNode.length>0){this.jid=Strophe.getText(jidNode[0]);if(this.do_session){this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2");this.send($iq({type:"set",id:"_session_auth_2"}).c("session",{xmlns:Strophe.NS.SESSION}).tree())}else{this.authenticated=true;this._changeConnectStatus(Strophe.Status.CONNECTED,null)}}}else{Strophe.info("SASL binding failed.");this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false}},_sasl_session_cb:function(elem){if(elem.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(Strophe.Status.CONNECTED,null)}else if(elem.getAttribute("type")=="error"){Strophe.info("Session creation failed.");this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false}return false},_sasl_failure_cb:function(elem){if(this._sasl_success_handler){this.deleteHandler(this._sasl_success_handler);this._sasl_success_handler=null}if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false},_auth2_cb:function(elem){if(elem.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(Strophe.Status.CONNECTED,null)}else if(elem.getAttribute("type")=="error"){this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);this.disconnect()}return false},_addSysTimedHandler:function(period,handler){var thand=new Strophe.TimedHandler(period,handler);thand.user=false;this.addTimeds.push(thand);return thand},_addSysHandler:function(handler,ns,name,type,id){var hand=new Strophe.Handler(handler,ns,name,type,id);hand.user=false;this.addHandlers.push(hand);return hand},_onDisconnectTimeout:function(){Strophe.info("_onDisconnectTimeout was called");var req;while(this._requests.length>0){req=this._requests.pop();req.abort=true;req.xhr.abort();req.xhr.onreadystatechange=function(){}}this._doDisconnect();return false},_onIdle:function(){var i,thand,since,newList;while(this.removeTimeds.length>0){thand=this.removeTimeds.pop();i=this.timedHandlers.indexOf(thand);if(i>=0)this.timedHandlers.splice(i,1)}while(this.addTimeds.length>0)this.timedHandlers.push(this.addTimeds.pop());var now=(new Date).getTime();newList=[];for(i=0;i<this.timedHandlers.length;i++){thand=this.timedHandlers[i];if(this.authenticated||!thand.user){since=thand.lastCalled+thand.period;if(since-now<=0){if(thand.run())newList.push(thand)}else newList.push(thand)}}this.timedHandlers=newList;var body,time_elapsed;if(this.authenticated&&this._requests.length===0&&this._data.length===0&&!this.disconnecting){Strophe.info("no requests during idle cycle, sending "+"blank request");this._data.push(null)}if(this._requests.length<2&&this._data.length>0&&!this.paused){body=this._buildBody();for(i=0;i<this._data.length;i++)if(this._data[i]!==null)if(this._data[i]==="restart")body.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Strophe.NS.BOSH});else body.cnode(this._data[i]).up();delete this._data;this._data=[];this._requests.push(new Strophe.Request(body.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),body.tree().getAttribute("rid")));this._processRequest(this._requests.length-1)}if(this._requests.length>0){time_elapsed=this._requests[0].age();if(this._requests[0].dead!==null)if(this._requests[0].timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait))this._throttledRequestHandler();if(time_elapsed>Math.floor(Strophe.TIMEOUT*this.wait)){Strophe.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Strophe.TIMEOUT*this.wait)+" seconds since last activity");this._throttledRequestHandler()}}clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}};if(callback)callback(Strophe,$build,$msg,$iq,$pres)})(function(){window.Strophe=arguments[0];window.$build=arguments[1];window.$msg=arguments[2];window.$iq=arguments[3];window.$pres=arguments[4]});function flxhr(global){var win=global,doc=global.document,UNDEF="undefined",JSTRUE=true,JSFALSE=false,EMPTY="",OBJECT="object",JSFUNC="function",JSSTR="string",JSDIV="div",JS_ONUNLOAD="onunload",tmp=null,_flensed=null,_chkplyr=null,_cp_ins=null,_flxhr_idc=0,_flxhr_inp=[],_flxhr_css=null,_flxhr=null,flXHR_js="https://thelivechatsoftware.com/dashboard/cwgen/scripts/chatscriptyui.js",flensed_js="https://thelivechatsoftware.com/dashboard/cwgen/scripts/flensed.js",flXHR_vbs="https://thelivechatsoftware.com/dashboard/cwgen/scripts/flXHR.vbs",checkplayer_js="https://thelivechatsoftware.com/dashboard/cwgen/scripts/checkplayer.js",flXHR_swf="https://thelivechatsoftware.com/dashboard/cwgen/scripts/flXHR.swf",PARSEINT=global.parseInt,SETTIMEOUT=global.setTimeout,CLEARTIMEOUT=global.clearTimeout,SETINTERVAL=global.setInterval,CLEARINTERVAL=global.clearInterval,_INSTANCEID_="instanceId",_READYSTATE_="readyState",_ONREADYSTATECHANGE_="onreadystatechange",_ONTIMEOUT_="ontimeout",_ONERROR_="onerror",_BINARYRESPONSEBODY_="binaryResponseBody",_XMLRESPONSETEXT_="xmlResponseText",_LOADPOLICYURL_="loadPolicyURL",_NOCACHEHEADER_="noCacheHeader",_SENDTIMEOUT_="sendTimeout",_APPENDTOID_="appendToId",_SWFIDPREFIX_="swfIdPrefix";if(typeof global.flensed===UNDEF)global.flensed={};if(typeof global.flensed.flXHR!==UNDEF)return;_flensed=global.flensed;SETTIMEOUT(function(){var base_path_known=JSFALSE,scriptArry=doc.getElementsByTagName("script"),scrlen=scriptArry.length;try{_flensed.base_path.toLowerCase();base_path_known=JSTRUE}catch(err){_flensed.base_path=EMPTY}
function load_script(src,type,language){for(var k=0;k<scrlen;k++)
if(typeof scriptArry[k].src!==UNDEF)
if(scriptArry[k].src.indexOf(src)>=0)break;var scriptElem=doc.createElement("script");scriptElem.setAttribute("src",src);if(typeof type!==UNDEF)scriptElem.setAttribute("type",type);if(typeof language!==UNDEF)scriptElem.setAttribute("language",language);doc.getElementsByTagName("head")[0].appendChild(scriptElem)}
if(typeof scriptArry!==UNDEF&&scriptArry!==null)
if(!base_path_known){var idx=0;for(var k=0;k<scrlen;k++)
if(typeof scriptArry[k].src!==UNDEF)
if((idx=scriptArry[k].src.indexOf(flensed_js))>=0||(idx=scriptArry[k].src.indexOf(flXHR_js))>=0){_flensed.base_path=scriptArry[k].src.substr(0,idx);break}}
try{_flensed.checkplayer.module_ready()}catch(err2){load_script(checkplayer_js,"text/javascript")}
var coreInterval=null;(function waitForCore(){try{_flensed.ua.pv.join(".")}catch(err){coreInterval=SETTIMEOUT(arguments.callee,25);return}
if(_flensed.ua.win&&_flensed.ua.ie)load_script(flXHR_vbs,"text/vbscript","vbscript");_flensed.binaryToString=function(binobj,skipVB){skipVB=_flensed.ua.win&&(_flensed.ua.ie&&typeof skipVB!==UNDEF)?!!skipVB:!(_flensed.ua.win&&_flensed.ua.ie);if(!skipVB)try{return flXHR_vb_BinaryToString(binobj)}catch(err){}
var str=EMPTY,buf=[];try{for(var i=0;i<binobj.length;i++)buf[buf.length]=String.fromCharCode(binobj[i]);str=buf.join(EMPTY)}catch(err2){}
return str};_flensed.bindEvent(win,JS_ONUNLOAD,function(){try{global.flensed.unbindEvent(win,JS_ONUNLOAD,arguments.callee);for(var k in _flxhr)
if(_flxhr[k]!==Object.prototype[k])try{_flxhr[k]=null}catch(err2){}
_flensed.flXHR=null;_flxhr=null;_flensed=null;_cp_ins=null;_chkplyr=null}catch(err3){}})})();function clearCoreInterval(){CLEARTIMEOUT(coreInterval);try{win.detachEvent(JS_ONUNLOAD,clearCoreInterval)}catch(err){}}
if(coreInterval!==null)try{win.attachEvent(JS_ONUNLOAD,clearCoreInterval)}catch(err3){}
var dependencyTimeout=null;function clearDependencyTimeout(){CLEARTIMEOUT(dependencyTimeout);try{win.detachEvent(JS_ONUNLOAD,clearDependencyTimeout)}catch(err){}}
try{win.attachEvent(JS_ONUNLOAD,clearDependencyTimeout)}catch(err4){}
dependencyTimeout=SETTIMEOUT(function(){clearDependencyTimeout();try{_flensed.checkplayer.module_ready()}catch(err2){throw new global.Error("flXHR dependencies failed to load.");}},2E4)},0);_flensed.flXHR=function(configObject){var instancePooling=JSFALSE;if(configObject!==null&&typeof configObject===OBJECT)
if(typeof configObject.instancePooling!==UNDEF){instancePooling=!!configObject.instancePooling;if(instancePooling){var ret=function(){for(var k=0;k<_flxhr_inp.length;k++){var inst=_flxhr_inp[k];if(inst[_READYSTATE_]===4){inst.Reset();inst.Configure(configObject);return inst}}
return null}();if(ret!==null)return ret}}
var idNumber=++_flxhr_idc,constructQueue=[],constructInterval=null,notReadyInterval=null,timeoutInterval=null,proxyId=null,readyState=-1,public_readyState=0,responseBody=null,responseText=null,responseXML=null,status=null,statusText=null,proxyObj=null,publicAPI=null,appendTo=null,rawresponse=null,queue_empty=JSTRUE,_error=JSFALSE,instanceId="flXHR_"+idNumber,noCacheHeader=JSTRUE,binaryResponseBody=JSFALSE,xmlResponseText=JSTRUE,autoUpdatePlayer=JSFALSE,proxyIdPrefix="flXHR_swf",styleClass="flXHRhideSwf",appendToId=null,sendTimeout=-1,loadPolicyURL=EMPTY,onreadystatechange=null,onerror=null,ontimeout=null;var constructor=function(){if(typeof configObject===OBJECT&&configObject!==null){if(typeof configObject[_INSTANCEID_]!==UNDEF&&(configObject[_INSTANCEID_]!==null&&configObject[_INSTANCEID_]!==EMPTY))instanceId=configObject[_INSTANCEID_];if(typeof configObject[_SWFIDPREFIX_]!==UNDEF&&(configObject[_SWFIDPREFIX_]!==null&&configObject[_SWFIDPREFIX_]!==EMPTY))proxyIdPrefix=configObject[_SWFIDPREFIX_];if(typeof configObject[_APPENDTOID_]!==UNDEF&&(configObject[_APPENDTOID_]!==null&&configObject[_APPENDTOID_]!==EMPTY))appendToId=configObject[_APPENDTOID_];if(typeof configObject[_LOADPOLICYURL_]!==UNDEF&&(configObject[_LOADPOLICYURL_]!==null&&configObject[_LOADPOLICYURL_]!==EMPTY))loadPolicyURL=configObject[_LOADPOLICYURL_];if(typeof configObject[_NOCACHEHEADER_]!==UNDEF)noCacheHeader=!!configObject[_NOCACHEHEADER_];if(typeof configObject[_BINARYRESPONSEBODY_]!==UNDEF)binaryResponseBody=!!configObject[_BINARYRESPONSEBODY_];if(typeof configObject[_XMLRESPONSETEXT_]!==UNDEF)xmlResponseText=!!configObject[_XMLRESPONSETEXT_];if(typeof configObject.autoUpdatePlayer!==UNDEF)autoUpdatePlayer=!!configObject.autoUpdatePlayer;if(typeof configObject[_SENDTIMEOUT_]!==UNDEF&&(tmp=PARSEINT(configObject[_SENDTIMEOUT_],10))>0)sendTimeout=tmp;if(typeof configObject[_ONREADYSTATECHANGE_]!==UNDEF&&configObject[_ONREADYSTATECHANGE_]!==null)onreadystatechange=configObject[_ONREADYSTATECHANGE_];if(typeof configObject[_ONERROR_]!==UNDEF&&configObject[_ONERROR_]!==null)onerror=configObject[_ONERROR_];if(typeof configObject[_ONTIMEOUT_]!==UNDEF&&configObject[_ONTIMEOUT_]!==null)ontimeout=configObject[_ONTIMEOUT_]}
proxyId=proxyIdPrefix+"_"+idNumber;function clearConstructInterval(){CLEARTIMEOUT(constructInterval);try{win.detachEvent(JS_ONUNLOAD,clearConstructInterval)}catch(err){}}
try{win.attachEvent(JS_ONUNLOAD,clearConstructInterval)}catch(err){}(function waitForCore(){try{_flensed.bindEvent(win,JS_ONUNLOAD,destructor)}catch(err){constructInterval=SETTIMEOUT(arguments.callee,25);return}
clearConstructInterval();constructInterval=SETTIMEOUT(continueConstructor,1)})()}();function continueConstructor(){if(appendToId===null)appendTo=doc.getElementsByTagName("body")[0];else appendTo=_flensed.getObjectById(appendToId);try{appendTo.nodeName.toLowerCase();_flensed.checkplayer.module_ready();_chkplyr=_flensed.checkplayer}catch(err){constructInterval=SETTIMEOUT(continueConstructor,25);return}
if(_cp_ins===null&&typeof _chkplyr._ins===UNDEF)try{_cp_ins=new _chkplyr(_flxhr.MIN_PLAYER_VERSION,checkCallback,JSFALSE,updateCallback)}catch(err2){doError(_flxhr.DEPENDENCY_ERROR,"flXHR: checkplayer Init Failed","The initialization of the 'checkplayer' library failed to complete.");return}else{_cp_ins=_chkplyr._ins;stillContinueConstructor()}}
function stillContinueConstructor(){if(_cp_ins===null||!_cp_ins.checkPassed){constructInterval=SETTIMEOUT(stillContinueConstructor,25);return}
if(_flxhr_css===null&&appendToId===null){_flensed.createCSS("."+styleClass,"left:-1px;top:0px;width:1px;height:1px;position:absolute;");_flxhr_css=JSTRUE}
var holder=doc.createElement(JSDIV);holder.id=proxyId;holder.className=styleClass;appendTo.appendChild(holder);appendTo=null;var flashvars={},params={allowScriptAccess:"always"},attributes={id:proxyId,name:proxyId,styleclass:styleClass},optionsObj={swfCB:finishConstructor,swfEICheck:"reset"};try{_cp_ins.DoSWF(_flensed.base_path+flXHR_swf,proxyId,"1","1",flashvars,params,attributes,optionsObj)}catch(err2){doError(_flxhr.DEPENDENCY_ERROR,"flXHR: checkplayer Call Failed","A call to the 'checkplayer' library failed to complete.");return}}
function finishConstructor(loadStatus){if(loadStatus.status!==_chkplyr.SWF_EI_READY)return;clearIntervals();proxyObj=_flensed.getObjectById(proxyId);proxyObj.setId(proxyId);if(loadPolicyURL!==EMPTY)proxyObj.loadPolicy(loadPolicyURL);proxyObj.autoNoCacheHeader(noCacheHeader);proxyObj.returnBinaryResponseBody(binaryResponseBody);proxyObj.doOnReadyStateChange=doOnReadyStateChange;proxyObj.doOnError=doError;proxyObj.sendProcessed=sendProcessed;proxyObj.chunkResponse=chunkResponse;readyState=0;updateFromPublicAPI();updatePublicAPI();if(typeof onreadystatechange===JSFUNC)try{onreadystatechange(publicAPI)}catch(err){doError(_flxhr.HANDLER_ERROR,"flXHR::onreadystatechange(): Error","An error occurred in the handler function. ("+err.message+")");return}
executeQueue()}
function destructor(){try{global.flensed.unbindEvent(win,JS_ONUNLOAD,destructor)}catch(err){}
try{for(var k=0;k<_flxhr_inp.length;k++)
if(_flxhr_inp[k]===publicAPI)_flxhr_inp[k]=JSFALSE}catch(err2){}
try{for(var j in publicAPI)
if(publicAPI[j]!==Object.prototype[j])try{publicAPI[j]=null}catch(err3){}}catch(err4){}
publicAPI=null;clearIntervals();if(typeof proxyObj!==UNDEF&&proxyObj!==null){try{proxyObj.abort()}catch(err5){}
try{proxyObj.doOnReadyStateChange=null;doOnReadyStateChange=null}catch(err6){}
try{proxyObj.doOnError=null;doOnError=null}catch(err7){}
try{proxyObj.sendProcessed=null;sendProcessed=null}catch(err8){}
try{proxyObj.chunkResponse=null;chunkResponse=null}catch(err9){}
proxyObj=null;try{global.swfobject.removeSWF(proxyId)}catch(err10){}}
emptyQueue();onreadystatechange=null;onerror=null;ontimeout=null;responseXML=null;responseBody=null;rawresponse=null;appendTo=null}
function chunkResponse(){if(binaryResponseBody&&typeof arguments[0]!==UNDEF){rawresponse=rawresponse!==null?rawresponse:[];rawresponse=rawresponse.concat(arguments[0])}else if(typeof arguments[0]===JSSTR){rawresponse=rawresponse!==null?rawresponse:EMPTY;rawresponse+=arguments[0]}}
function doOnReadyStateChange(){if(typeof arguments[0]!==UNDEF)readyState=arguments[0];if(readyState===4){clearIntervals();if(binaryResponseBody&&rawresponse!==null)try{responseText=_flensed.binaryToString(rawresponse,JSTRUE);try{responseBody=flXHR_vb_StringToBinary(responseText)}catch(err4){responseBody=rawresponse}}catch(err){}else responseText=rawresponse;rawresponse=null;if(responseText!==EMPTY)
if(xmlResponseText)try{responseXML=_flensed.parseXMLString(responseText)}catch(err2){responseXML={}}}
if(typeof arguments[1]!==UNDEF)status=arguments[1];if(typeof arguments[2]!==UNDEF)statusText=arguments[2];doPublicOnReadyStateChange(readyState)}
function doPublicOnReadyStateChange(rdySt){public_readyState=rdySt;updateFromPublicAPI();updatePublicAPI();publicAPI[_READYSTATE_]=Math.max(0,rdySt);if(typeof onreadystatechange===JSFUNC)try{onreadystatechange(publicAPI)}catch(err){doError(_flxhr.HANDLER_ERROR,"flXHR::onreadystatechange(): Error","An error occurred in the handler function. ("+err.message+")");return}}
function doError(){clearIntervals();emptyQueue();_error=JSTRUE;var errorObj;try{errorObj=new _flensed.error(arguments[0],arguments[1],arguments[2],publicAPI)}catch(err){function ErrorObjTemplate(){this.number=0;this.name="flXHR Error: Unknown";this.description="Unknown error from 'flXHR' library.";this.message=this.description;this.srcElement=publicAPI;var a=this.number,b=this.name,c=this.description;function toString(){return a+", "+b+", "+c}
this.toString=toString}
errorObj=new ErrorObjTemplate}
var handled=JSFALSE;try{if(typeof onerror===JSFUNC){onerror(errorObj);handled=JSTRUE}}catch(err2){var prevError=errorObj.toString();function ErrorObjTemplate2(){this.number=_flxhr.HANDLER_ERROR;this.name="flXHR::onerror(): Error";this.description="An error occured in the handler function. ("+err2.message+")\nPrevious:["+prevError+"]";this.message=this.description;this.srcElement=publicAPI;var a=this.number,b=this.name,c=this.description;function toString(){return a+", "+b+", "+c}
this.toString=toString}
errorObj=new ErrorObjTemplate2}}
function doTimeout(){abort();_error=JSTRUE;if(typeof ontimeout===JSFUNC)try{ontimeout(publicAPI)}catch(err){doError(_flxhr.HANDLER_ERROR,"flXHR::ontimeout(): Error","An error occurred in the handler function. ("+err.message+")");return}else doError(_flxhr.TIMEOUT_ERROR,"flXHR: Operation Timed out","The requested operation timed out.")}
function clearIntervals(){CLEARTIMEOUT(constructInterval);constructInterval=null;CLEARTIMEOUT(timeoutInterval);timeoutInterval=null;CLEARTIMEOUT(notReadyInterval);notReadyInterval=null}
function addToQueue(func,funcName,args){constructQueue[constructQueue.length]={func:func,funcName:funcName,args:args};queue_empty=JSFALSE}
function emptyQueue(){if(!queue_empty){queue_empty=JSTRUE;var queuelength=constructQueue.length;for(var m=0;m<queuelength;m++)try{constructQueue[m]=JSFALSE}catch(err){}
constructQueue=[]}}
function executeQueue(){if(readyState<0){notReadyInterval=SETTIMEOUT(executeQueue,25);return}
if(!queue_empty){for(var j=0;j<constructQueue.length;j++)try{if(constructQueue[j]!==JSFALSE){constructQueue[j].func.apply(publicAPI,constructQueue[j].args);constructQueue[j]=JSFALSE}}catch(err){doError(_flxhr.HANDLER_ERROR,"flXHR::"+constructQueue[j].funcName+"(): Error","An error occurred in the "+constructQueue[j].funcName+"() function.");return}
queue_empty=JSTRUE}}
function updatePublicAPI(){try{publicAPI[_INSTANCEID_]=instanceId;publicAPI[_READYSTATE_]=public_readyState;publicAPI.status=status;publicAPI.statusText=statusText;publicAPI.responseText=responseText;publicAPI.responseXML=responseXML;publicAPI.responseBody=responseBody;publicAPI[_ONREADYSTATECHANGE_]=onreadystatechange;publicAPI[_ONERROR_]=onerror;publicAPI[_ONTIMEOUT_]=ontimeout;publicAPI[_LOADPOLICYURL_]=loadPolicyURL;publicAPI[_NOCACHEHEADER_]=noCacheHeader;publicAPI[_BINARYRESPONSEBODY_]=binaryResponseBody;publicAPI[_XMLRESPONSETEXT_]=xmlResponseText}catch(err){}}
function updateFromPublicAPI(){try{instanceId=publicAPI[_INSTANCEID_];if(publicAPI.timeout!==null&&(tmp=PARSEINT(publicAPI.timeout,10))>0)sendTimeout=tmp;onreadystatechange=publicAPI[_ONREADYSTATECHANGE_];onerror=publicAPI[_ONERROR_];ontimeout=publicAPI[_ONTIMEOUT_];if(publicAPI[_LOADPOLICYURL_]!==null){if(publicAPI[_LOADPOLICYURL_]!==loadPolicyURL&&readyState>=0)proxyObj.loadPolicy(publicAPI[_LOADPOLICYURL_]);loadPolicyURL=publicAPI[_LOADPOLICYURL_]}
if(publicAPI[_NOCACHEHEADER_]!==null){if(publicAPI[_NOCACHEHEADER_]!==noCacheHeader&&readyState>=0)proxyObj.autoNoCacheHeader(publicAPI[_NOCACHEHEADER_]);noCacheHeader=publicAPI[_NOCACHEHEADER_]}
if(publicAPI[_BINARYRESPONSEBODY_]!==null){if(publicAPI[_BINARYRESPONSEBODY_]!==binaryResponseBody&&readyState>=0)proxyObj.returnBinaryResponseBody(publicAPI[_BINARYRESPONSEBODY_]);binaryResponseBody=publicAPI[_BINARYRESPONSEBODY_]}
if(xmlResponseText!==null)xmlResponseText=!!publicAPI[_XMLRESPONSETEXT_]}catch(err){}}
function reset(){abort();try{proxyObj.reset()}catch(err){}
status=null;statusText=null;responseText=null;responseXML=null;responseBody=null;rawresponse=null;_error=JSFALSE;updatePublicAPI();loadPolicyURL=EMPTY;updateFromPublicAPI()}
function checkCallback(checkObj){if(checkObj.checkPassed)stillContinueConstructor();else if(!autoUpdatePlayer)doError(_flxhr.PLAYER_VERSION_ERROR,"flXHR: Insufficient Flash Player Version","The Flash Player was either not detected, or the detected version ("+checkObj.playerVersionDetected+") was not at least the minimum version ("+_flxhr.MIN_PLAYER_VERSION+") needed by the 'flXHR' library.");else _cp_ins.UpdatePlayer()}
function updateCallback(checkObj){if(checkObj.updateStatus===_chkplyr.UPDATE_CANCELED)doError(_flxhr.PLAYER_VERSION_ERROR,"flXHR: Flash Player Update Canceled","The Flash Player was not updated.");else if(checkObj.updateStatus===_chkplyr.UPDATE_FAILED)doError(_flxhr.PLAYER_VERSION_ERROR,"flXHR: Flash Player Update Failed","The Flash Player was either not detected or could not be updated.")}
function sendProcessed(){if(sendTimeout!==null&&sendTimeout>0)timeoutInterval=SETTIMEOUT(doTimeout,sendTimeout)}
function abort(){clearIntervals();emptyQueue();updateFromPublicAPI();readyState=0;public_readyState=0;try{proxyObj.abort()}catch(err){doError(_flxhr.CALL_ERROR,"flXHR::abort(): Failed","The abort() call failed to complete.")}
updatePublicAPI()}
function open(){updateFromPublicAPI();if(typeof arguments[0]===UNDEF||typeof arguments[1]===UNDEF)doError(_flxhr.CALL_ERROR,"flXHR::open(): Failed","The open() call requires 'method' and 'url' parameters.");else{if(readyState>0||_error)reset();if(public_readyState===0)doOnReadyStateChange(1);else readyState=1;var a0=arguments[0],a1=arguments[1],a2=typeof arguments[2]!==UNDEF?arguments[2]:JSTRUE,a3=typeof arguments[3]!==UNDEF?arguments[3]:EMPTY,a4=typeof arguments[4]!==UNDEF?arguments[4]:EMPTY;try{proxyObj.autoNoCacheHeader(noCacheHeader);proxyObj.open(a0,a1,a2,a3,a4)}catch(err){doError(_flxhr.CALL_ERROR,"flXHR::open(): Failed","The open() call failed to complete.")}}}
function send(){updateFromPublicAPI();if(readyState<=1&&!_error){var a0=typeof arguments[0]!==UNDEF?arguments[0]:EMPTY;if(public_readyState===1)doOnReadyStateChange(2);else readyState=2;try{proxyObj.autoNoCacheHeader(noCacheHeader);proxyObj.send(a0)}catch(err){doError(_flxhr.CALL_ERROR,"flXHR::send(): Failed","The send() call failed to complete.")}}else doError(_flxhr.CALL_ERROR,"flXHR::send(): Failed","The send() call cannot be made at this time.")}
function setRequestHeader(){updateFromPublicAPI();if(typeof arguments[0]===UNDEF||typeof arguments[1]===UNDEF)doError(_flxhr.CALL_ERROR,"flXHR::setRequestHeader(): Failed","The setRequestHeader() call requires 'name' and 'value' parameters.");else if(!_error){var a0=typeof arguments[0]!==UNDEF?arguments[0]:EMPTY,a1=typeof arguments[1]!==UNDEF?arguments[1]:EMPTY;try{proxyObj.setRequestHeader(a0,a1)}catch(err){doError(_flxhr.CALL_ERROR,"flXHR::setRequestHeader(): Failed","The setRequestHeader() call failed to complete.")}}}
function getResponseHeader(){updateFromPublicAPI();return EMPTY}
function getAllResponseHeaders(){updateFromPublicAPI();return[]}
publicAPI={readyState:public_readyState,responseBody:responseBody,responseText:responseText,responseXML:responseXML,status:status,statusText:statusText,timeout:sendTimeout,open:function(){updateFromPublicAPI();if(publicAPI[_READYSTATE_]===0)doPublicOnReadyStateChange(1);if(!queue_empty||readyState<0){addToQueue(open,"open",arguments);return}
open.apply({},arguments)},send:function(){updateFromPublicAPI();if(publicAPI[_READYSTATE_]===1)doPublicOnReadyStateChange(2);if(!queue_empty||readyState<0){addToQueue(send,"send",arguments);return}
send.apply({},arguments)},abort:abort,setRequestHeader:function(){updateFromPublicAPI();if(!queue_empty||readyState<0){addToQueue(setRequestHeader,"setRequestHeader",arguments);return}
setRequestHeader.apply({},arguments)},getResponseHeader:getResponseHeader,getAllResponseHeaders:getAllResponseHeaders,onreadystatechange:onreadystatechange,ontimeout:ontimeout,instanceId:instanceId,loadPolicyURL:loadPolicyURL,noCacheHeader:noCacheHeader,binaryResponseBody:binaryResponseBody,xmlResponseText:xmlResponseText,onerror:onerror,Configure:function(configObj){if(typeof configObj===OBJECT&&configObj!==null){if(typeof configObj[_INSTANCEID_]!==UNDEF&&(configObj[_INSTANCEID_]!==null&&configObj[_INSTANCEID_]!==EMPTY))instanceId=configObj[_INSTANCEID_];if(typeof configObj[_NOCACHEHEADER_]!==UNDEF){noCacheHeader=!!configObj[_NOCACHEHEADER_];if(readyState>=0)proxyObj.autoNoCacheHeader(noCacheHeader)}
if(typeof configObj[_BINARYRESPONSEBODY_]!==UNDEF){binaryResponseBody=!!configObj[_BINARYRESPONSEBODY_];if(readyState>=0)proxyObj.returnBinaryResponseBody(binaryResponseBody)}
if(typeof configObj[_XMLRESPONSETEXT_]!==UNDEF)xmlResponseText=!!configObj[_XMLRESPONSETEXT_];if(typeof configObj[_ONREADYSTATECHANGE_]!==UNDEF&&configObj[_ONREADYSTATECHANGE_]!==null)onreadystatechange=configObj[_ONREADYSTATECHANGE_];if(typeof configObj[_ONERROR_]!==UNDEF&&configObj[_ONERROR_]!==null)onerror=configObj[_ONERROR_];if(typeof configObj[_ONTIMEOUT_]!==UNDEF&&configObj[_ONTIMEOUT_]!==null)ontimeout=configObj[_ONTIMEOUT_];if(typeof configObj[_SENDTIMEOUT_]!==UNDEF&&(tmp=PARSEINT(configObj[_SENDTIMEOUT_],10))>0)sendTimeout=tmp;if(typeof configObj[_LOADPOLICYURL_]!==UNDEF&&(configObj[_LOADPOLICYURL_]!==null&&(configObj[_LOADPOLICYURL_]!==EMPTY&&configObj[_LOADPOLICYURL_]!==loadPolicyURL))){loadPolicyURL=configObj[_LOADPOLICYURL_];if(readyState>=0)proxyObj.loadPolicy(loadPolicyURL)}
updatePublicAPI()}},Reset:reset,Destroy:destructor};if(instancePooling)_flxhr_inp[_flxhr_inp.length]=publicAPI;return publicAPI};_flxhr=_flensed.flXHR;_flxhr.HANDLER_ERROR=10;_flxhr.CALL_ERROR=11;_flxhr.TIMEOUT_ERROR=12;_flxhr.DEPENDENCY_ERROR=13;_flxhr.PLAYER_VERSION_ERROR=14;_flxhr.SECURITY_ERROR=15;_flxhr.COMMUNICATION_ERROR=16;_flxhr.MIN_PLAYER_VERSION="9";_flxhr.module_ready=function(){}}
function getInternetExplorerVersion(){var rv=-1;if(navigator.appName=="Microsoft Internet Explorer"){var ua=navigator.userAgent;var re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!=null)rv=parseFloat(RegExp.$1)}
return rv}
function lesserVersionEight(){Strophe.addConnectionPlugin("flxhr",{init:function(){if(flensed&&flensed.flXHR)Strophe.Request.prototype._newXHR=function(){var xhr=new flensed.flXHR({autoUpdatePlayer:true,instancePooling:true,noCacheHeader:false});xhr.onreadystatechange=this.func.prependArg(this);return xhr}}})}
function versionEight(){Strophe.addConnectionPlugin("xdomainrequest",{init:function(){if(window.XDomainRequest){if(typeof XDomainRequest.prototype.oldsend=="undefined"){XDomainRequest.prototype.oldsend=XDomainRequest.prototype.send;XDomainRequest.prototype.send=function(){var junk=arguments;XDomainRequest.prototype.oldsend.apply(this,arguments);this.readyState=2;try{this.onreadystatechange()}catch(e){}}}
Strophe.Request.prototype._newXHR=function(){var fireReadyStateChange=function(xhr,status){xhr.status=status;xhr.readyState=4;try{xhr.onreadystatechange()}catch(e){}};var xhr=new XDomainRequest;xhr.readyState=0;xhr.onreadystatechange=this.func.prependArg(this);xhr.onload=function(){xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(xhr.responseText);xhr.responseXML=xmlDoc;fireReadyStateChange(xhr,200)};xhr.onerror=function(){fireReadyStateChange(xhr,500)};xhr.ontimeout=function(){fireReadyStateChange(xhr,500)};return xhr}}}})}
function versionNine(){Strophe.addConnectionPlugin("xdomainrequest",{init:function(){if(window.XDomainRequest){Strophe.debug("using XdomainRequest for IE");if(typeof XDomainRequest.prototype.oldsend=="undefined"){XDomainRequest.prototype.oldsend=XDomainRequest.prototype.send;XDomainRequest.prototype.send=function(){var junk=arguments;XDomainRequest.prototype.oldsend.apply(this,arguments);this.readyState=2;try{this.onreadystatechange()}catch(e){}}}
Strophe.Request.prototype._newXHR=function(){var fireReadyStateChange=function(xhr,status){xhr.status=status;xhr.readyState=4;try{xhr.onreadystatechange()}catch(e){}};var xhr=new XDomainRequest;xhr.readyState=0;xhr.onreadystatechange=this.func.prependArg(this);xhr.onload=function(){xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(xhr.responseText);xhr.responseXML=xmlDoc;fireReadyStateChange(xhr,200)};xhr.onerror=function(){fireReadyStateChange(xhr,500)};xhr.ontimeout=function(){fireReadyStateChange(xhr,500)};return xhr}}}})}
function versionTen(){Strophe.addConnectionPlugin("xdomainrequest",{init:function(){if(window.XDomainRequest){var MyXHR=function(){var that=new XDomainRequest;var oldsend=that.send;that.send=function(){oldsend.apply(that,arguments);that.readyState=2;try{that.onreadystatechange()}catch(e){}};return that};Strophe.Request.prototype._newXHR=function(){var fireReadyStateChange=function(xhr,status){xhr.status=status;xhr.readyState=4;try{xhr.onreadystatechange()}catch(e){}};var xhr=MyXHR();xhr.readyState=0;xhr.onreadystatechange=this.func.bind(null,this);xhr.onload=function(){xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(xhr.responseText);xhr.responseXML=xmlDoc;fireReadyStateChange(xhr,200)};xhr.onerror=function(){Strophe.error("Strophe xdr.onerror called");fireReadyStateChange(xhr,500)};xhr.ontimeout=function(){Strophe.error("Strophe xdr.ontimeout called");fireReadyStateChange(xhr,500)};return xhr}}}})}
function checkVersion(){var ver=getInternetExplorerVersion();if(ver>-1&&ver>=6){flxhr(window);if(ver<8)lesserVersionEight();else if(ver==8)versionEight();else if(ver==9)versionNine();else versionTen()}}